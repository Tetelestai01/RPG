<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A Lenda da Chave Perdida</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #111;
      color: #f4f4f4;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    #game, #menu, #char-creation { display: none; }
    .hud {
      background: #222;
      padding: 10px;
      display: flex;
      justify-content: space-around;
      font-size: 14px;
    }
    .hud span { cursor: pointer; }
    #output {
      padding: 20px;
      min-height: 200px;
      text-align: left;
      background: #1c1c1c;
      border-top: 2px solid #333;
      overflow-y: auto;
    }
    .btn {
      background: #444;
      color: white;
      padding: 10px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: block;
      width: 90%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }
    .btn:hover { background: #666; }
  </style>
</head>
<body>

  <!-- Tela inicial -->
  <div id="menu">
    <h1>‚öîÔ∏è A Lenda da Chave Perdida ‚öîÔ∏è</h1>
    <button class="btn" onclick="startCharCreation()">Criar Ficha</button>
  </div>

  <!-- Cria√ß√£o de personagem -->
  <div id="char-creation">
    <h2>Cria√ß√£o de Personagem</h2>
    <label>Nome: <input id="charName" type="text"></label><br><br>
    <button class="btn" onclick="saveCharacter()">Salvar Ficha</button>
  </div>

  <!-- HUD -->
  <div id="game">
    <div class="hud">
      <span id="hudPV"></span>
      <span id="hudGold" onclick="goldClicked()"></span>
      <span id="hudAttr"></span>
      <span id="hudMao"></span>
      <span id="hudNivel"></span>
    </div>
    <div id="output"></div>
    <div id="actions"></div>
    <div>
      <button class="btn" onclick="openMenu()">Menu</button>
    </div>
  </div>

  <!-- Menu pausa -->
  <div id="pauseMenu" style="display:none;">
    <h2>Menu</h2>
    <button class="btn" onclick="resumeGame()">Retomar</button>
    <button class="btn" onclick="restartGame()">Reiniciar</button>
    <button class="btn" onclick="quitGame()">Sair do Jogo</button>
  </div>

  <script>
    let player = {
      nome: "",
      pv: 30,
      vigor: 3,
      forca: 3,
      destreza: 3,
      ouro: 50,
      nivel: 1,
      mao: "",
      inventario: [],
      propinaReady: false // controla easter egg
    };

    let inBattle = false;
    let inConversation = false;

    function startCharCreation() {
      document.getElementById("menu").style.display = "none";
      document.getElementById("char-creation").style.display = "block";
    }

    function saveCharacter() {
      const nome = document.getElementById("charName").value.trim();
      if (!nome) {
        alert("Digite um nome!");
        return;
      }
      player.nome = nome;
      document.getElementById("char-creation").style.display = "none";
      document.getElementById("game").style.display = "block";
      intro();
    }

    function intro() {
      log(`üëë O Rei Robert convoca voc√™, ${player.nome}, para uma miss√£o: recuperar os quatro fragmentos da Chave Perdida. 
      Apenas com a chave completa ser√° poss√≠vel derrotar o drag√£o que amea√ßa o reino. Boa sorte, her√≥i!`);
      showActions(["Ir √† cidade", "Ir √† floresta", "Checar invent√°rio"]);
      updateHUD();
    }

    function showActions(actions) {
      const actionsDiv = document.getElementById("actions");
      actionsDiv.innerHTML = "";
      actions.forEach(act => {
        const btn = document.createElement("button");
        btn.textContent = act;
        btn.className = "btn";
        btn.onclick = () => handleAction(act);
        actionsDiv.appendChild(btn);
      });
    }

    function handleAction(act) {
      if (act === "Ir √† cidade") {
        inConversation = true;
        log("üèôÔ∏è Voc√™ chega √† cidade. Um alde√£o se aproxima para conversar.");
        showActions(["Conversar com alde√£o", "Voltar"]);
      }
      else if (act === "Ir √† floresta") {
        inBattle = true;
        log("üå≤ Na floresta, um goblin salta diante de voc√™!");
        startBattle({ nome: "Goblin", pv: 12, armadura: 2, ataque: 3 });
      }
      else if (act === "Checar invent√°rio") {
        openInventory();
      }
      else if (act === "Conversar com alde√£o") {
        npcConversation();
      }
      else if (act === "Voltar") {
        inConversation = false;
        intro();
      }
    }

    function npcConversation() {
      log("üßë‚Äçüåæ O alde√£o fala: 'Her√≥i, ouvi rumores sobre um dos fragmentos da chave perdido nas montanhas.'");
      showActions(["Agradecer", "Voltar"]);
      maybeShowPropina();
    }

    // --- Sistema de invent√°rio ---
    function openInventory() {
      let invText = "üì¶ Invent√°rio:\n";
      if (player.inventario.length === 0) invText += "Vazio.";
      else invText += player.inventario.join(", ");
      invText += `\n\nüñêÔ∏è Na m√£o: ${player.mao || "vazio"}`;
      log(invText);
      showActions(["Colocar espada na m√£o", "Colocar po√ß√£o na m√£o", "Jogar fora item", "Voltar"]);
    }

    // --- Sistema de batalha ---
    function startBattle(enemy) {
      inBattle = true;
      log(`‚öîÔ∏è Um ${enemy.nome} aparece!`);
      showActions(["Atacar", "Defender", "Fugir"]);
      maybeShowPropina();
    }

    function rollDice() {
      return Math.floor(Math.random() * 6) + 1;
    }

    function attackEnemy(enemy) {
      const dado = rollDice();
      const ataque = dado + player.destreza + (player.mao === "espada" ? 2 : 0);
      log(`üé≤ Voc√™ rolou ${dado} + Destreza(${player.destreza})${player.mao === "espada" ? " + Espada(2)" : ""} = Ataque ${ataque}`);
      // exemplo defesa inimiga
      const defesaDado = rollDice();
      const defesa = defesaDado + enemy.armadura;
      log(`üõ°Ô∏è O inimigo rolou ${defesaDado} + Armadura(${enemy.armadura}) = Defesa ${defesa}`);
      if (ataque > defesa) {
        enemy.pv -= (ataque - defesa);
        log(`üí• Voc√™ acertou! O ${enemy.nome} ficou com ${enemy.pv} PV`);
      } else {
        log("‚ùå Seu ataque n√£o passou pela defesa.");
      }
    }

    // --- Easter egg da propina ---
    function goldClicked() {
      if (player.ouro <= 20) {
        player.propinaReady = true;
        log("üí∞ Voc√™ olha para seu ouro... algo parece poss√≠vel.");
      }
    }

    function maybeShowPropina() {
      if (player.propinaReady && (inBattle || inConversation)) {
        const btn = document.createElement("button");
        btn.textContent = "Dar propina";
        btn.className = "btn";
        btn.onclick = () => usePropina();
        document.getElementById("actions").appendChild(btn);
      }
    }

    function usePropina() {
      if (inBattle) {
        log("üí∏ Voc√™ tentou subornar o inimigo! Ele aceita e voc√™ foge... mas perde 1 n√≠vel.");
        player.nivel = Math.max(1, player.nivel - 1);
        inBattle = false;
        intro();
      } else if (inConversation) {
        log("üí∏ Voc√™ oferece uma propina. O alde√£o revela informa√ß√µes privilegiadas: 'Dizem que outro fragmento est√° escondido nas ru√≠nas antigas.'");
        inConversation = false;
        intro();
      }
      player.propinaReady = false;
      updateHUD();
    }

    // --- Utilidades ---
    function log(text) {
      document.getElementById("output").innerHTML += `<p>${text}</p>`;
      document.getElementById("output").scrollTop = document.getElementById("output").scrollHeight;
    }

    function updateHUD() {
      document.getElementById("hudPV").textContent = `PV: ${player.pv}`;
      document.getElementById("hudGold").textContent = `üí∞ Ouro: ${player.ouro}`;
      document.getElementById("hudAttr").textContent = `F(${player.forca}${player.mao==="espada" ? " +2":""}), D(${player.destreza}), V(${player.vigor})`;
      document.getElementById("hudMao").textContent = `üñêÔ∏è M√£o: ${player.mao || "vazio"}`;
      document.getElementById("hudNivel").textContent = `N√≠vel: ${player.nivel}`;
    }

    // --- Menu ---
    function openMenu() {
      document.getElementById("game").style.display = "none";
      document.getElementById("pauseMenu").style.display = "block";
    }
    function resumeGame() {
      document.getElementById("pauseMenu").style.display = "none";
      document.getElementById("game").style.display = "block";
    }
    function restartGame() {
      player = { nome:"", pv:30, vigor:3, forca:3, destreza:3, ouro:50, nivel:1, mao:"", inventario:[], propinaReady:false };
      document.getElementById("pauseMenu").style.display = "none";
      document.getElementById("menu").style.display = "block";
      document.getElementById("output").innerHTML = "";
    }
    function quitGame() {
      restartGame();
    }

    // inicia no menu
    document.getElementById("menu").style.display = "block";
  </script>
</body>
</html>
