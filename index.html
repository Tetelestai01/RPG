<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RPG Betsim - Missão dos Artefatos</title>
<style>
body {font-family:'Segoe UI',sans-serif; margin:0; padding:0; background:#f5f5f5; color:#333;}
#hud {position:fixed; top:0; left:0; width:100%; background:#222; color:#fff; padding:10px; font-weight:bold; display:flex; justify-content:space-around; flex-wrap:wrap; z-index:100;}
#hud span{margin:0 5px;}
#gameScreen {padding:70px 10px 10px 10px;}
button {margin:5px; padding:10px; border:none; border-radius:5px; background:#555; color:white; font-weight:bold; font-size:16px;}
button:hover{background:#333; cursor:pointer;}
input {margin:5px; padding:5px; border-radius:3px; border:1px solid #ccc;}
.hidden{display:none;}
#inventory, #hand, #menu{border:1px solid #aaa; padding:5px; margin:5px; border-radius:5px; background:#eee;}
#battleLog{border:1px solid #aaa; padding:5px; margin:5px; height:150px; overflow-y:auto; background:#fff;}
</style>
</head>
<body>

<div id="hud" class="hidden">
<span id="playerName"></span>
<span id="playerStats"></span>
<span id="playerPV"></span>
<span id="playerXP"></span>
<span id="playerGold"></span>
<span id="playerHand"></span>
<button onclick="openMenu()">Menu</button>
</div>

<div id="gameScreen">
  <div id="startScreen">
    <h1>RPG Betsim - Missão dos Artefatos</h1>
    <button onclick="startCharacterCreation()">Criar Ficha</button>
  </div>

  <div id="createScreen" class="hidden">
    <h2>Criar Ficha</h2>
    <label>Nome: <input type="text" id="charName"></label><br>
    <label>Distribua 10 pontos:</label><br>
    Vigor <span id="vigorValue">0</span> <button onclick="addPoint('vigor')">+</button><br>
    Força <span id="forcaValue">0</span> <button onclick="addPoint('forca')">+</button><br>
    Destreza <span id="destrezaValue">0</span> <button onclick="addPoint('destreza')">+</button><br>
    Armadura <span id="armaduraValue">0</span> <button onclick="addPoint('armadura')">+</button><br>
    <button onclick="finishCharacter()">Finalizar Ficha</button>
  </div>

  <div id="gameplay" class="hidden">
    <div id="locationScreen"></div>
    <div id="battleLog" class="hidden"></div>
  </div>

  <div id="menuScreen" class="hidden">
    <button onclick="resumeGame()">Continuar</button>
    <button onclick="restartGame()">Reiniciar Jogo</button>
    <button onclick="exitGame()">Sair do Jogo</button>
  </div>
</div>

<script>
// --- Player ---
let player = {
    name:'',
    vigor:0,
    forca:0,
    destreza:0,
    armadura:0,
    pv:0,
    gold:50,
    xp:0,
    level:1,
    hand:null,
    weapon:null,
    inventory:[null,null,null]
};
let totalPoints = 10;
let exploredLocations = {};
let propinaBonusActive = false;
let artifactsFound = [false,false,false,false];

// --- Criação de ficha ---
function startCharacterCreation(){
    document.getElementById('startScreen').classList.add('hidden');
    document.getElementById('createScreen').classList.remove('hidden');
}

function addPoint(attr){
    let sum = player.vigor + player.forca + player.destreza + player.armadura;
    if(sum >= totalPoints) return alert('Todos os pontos distribuídos');
    player[attr]++;
    document.getElementById(attr+'Value').innerText = player[attr];
}

function finishCharacter(){
    const name = document.getElementById('charName').value;
    if(!name) return alert('Digite o nome do personagem');
    const sum = player.vigor + player.forca + player.destreza + player.armadura;
    if(sum < totalPoints) return alert('Distribua todos os pontos');
    player.name = name;
    player.pv = player.vigor * 10;
    document.getElementById('createScreen').classList.add('hidden');
    document.getElementById('hud').classList.remove('hidden');
    document.getElementById('gameplay').classList.remove('hidden');
    updateHUD();
    startAdventure();
}

// --- HUD ---
function updateHUD(){
    document.getElementById('playerName').innerText = player.name;
    document.getElementById('playerPV').innerText = `PV: ${player.pv}`;
    document.getElementById('playerGold').innerText = `Ouro: ${player.gold}`;
    document.getElementById('playerXP').innerText = `XP: ${player.xp}`;
    document.getElementById('playerStats').innerText = `F(${player.forca + (player.weapon?player.weapon.forceBonus:0)}), V(${player.vigor}), D(${player.destreza}), A(${player.armadura})`;
    document.getElementById('playerHand').innerText = `Mão: ${player.hand ? player.hand.name : 'vazio'}`;
}

// --- Menu ---
function openMenu(){document.getElementById('menuScreen').classList.remove('hidden');}
function resumeGame(){document.getElementById('menuScreen').classList.add('hidden');}
function restartGame(){location.reload();}
function exitGame(){if(confirm('Deseja realmente sair? Toda ficha será perdida.')) location.reload();}

// --- XP ---
function gainXP(sourceType, value, extraData=null){
    let xpGain = value;
    if(sourceType==='explore'){
        const loc = extraData;
        if(exploredLocations[loc]) return;
        exploredLocations[loc] = true;
        alert(`Você ganhou ${xpGain} XP explorando ${loc}!`);
    }
    if(sourceType==='propina' && propinaBonusActive) xpGain*=2;
    player.xp += xpGain;
    updateHUD();
    checkLevelUp();
}
function checkLevelUp(){
    let nextXP = Math.floor(100 * Math.pow(1.5, player.level-1));
    if(player.xp >= nextXP){
        player.level++;
        player.xp -= nextXP;
        alert(`Parabéns! Subiu para o nível ${player.level}!`);
        allocateAttributePoint();
        updateHUD();
        checkLevelUp();
    }
}
function allocateAttributePoint(){
    const attr = prompt(`Distribua 1 ponto em: vigor, forca, destreza ou armadura`).toLowerCase();
    if(attr==='vigor') player.vigor++;
    else if(attr==='forca') player.forca++;
    else if(attr==='destreza') player.destreza++;
    else if(attr==='armadura') player.armadura++;
    else alert('Atributo inválido, ponto perdido');
    player.pv = player.vigor*10;
}

// --- Aventura ---
function startAdventure(){navigateLocation('inicio');}

function navigateLocation(loc){
    let content='';
    if(loc==='inicio'){
        content=`<h2>O Rei Robert convoca você para recuperar os 4 artefatos da chave!</h2>
        <button onclick="navigateLocation('cidade')">Ir à Cidade</button>
        <button onclick="navigateLocation('floresta')">Explorar Floresta</button>
        <button onclick="navigateLocation('biblioteca')">Ir à Biblioteca</button>`;
    } else if(loc==='cidade'){
        content=`<h3>Cidade de Betsim</h3>
        <button onclick="gainXP('explore',20,'cidade')">Explorar ruas</button>
        <button onclick="startBattle()">Encontrar inimigo</button>
        <button onclick="openShop()">Ir à Loja</button>
        <button onclick="navigateLocation('inicio')">Voltar</button>`;
    } else if(loc==='floresta'){
        if(!player.weapon) alert('Cuidado! Você está sem espada.');
        content=`<h3>Floresta</h3>
        <button onclick="gainXP('explore',40,'floresta')">Explorar trilhas</button>
        <button onclick="startBattle()">Encontrar inimigo</button>
        <button onclick="navigateLocation('inicio')">Voltar</button>`;
    } else if(loc==='biblioteca'){
        content=`<h3>Biblioteca</h3>
        <button onclick="gainXP('explore',50,'biblioteca')">Pesquisar livros</button>
        <button onclick="navigateLocation('inicio')">Voltar</button>`;
    }
    document.getElementById('locationScreen').innerHTML = content;
    document.getElementById('battleLog').classList.add('hidden');
    updateHUD();
}

// --- Batalha com rolagem de dados ---
function startBattle(){
    let enemy = {
        name:'Inimigo',
        vigor:2,
        forca:2,
        destreza:2,
        armadura:1,
        pv:20
    };
    document.getElementById('battleLog').classList.remove('hidden');
    document.getElementById('battleLog').innerHTML = `<h3>Batalha contra ${enemy.name}</h3>`;
    battleTurn(enemy);
}

function battleTurn(enemy){
    if(player.pv<=0){alert('Você morreu!'); return;}
    if(enemy.pv<=0){alert('Inimigo derrotado!'); gainXP('combat',50); return;}
    rollDice('player', player, enemy);
}

function rollDice(attackerType, attacker, defender){
    let roll = 0, rollInterval;
    let log = document.getElementById('battleLog');
    log.innerHTML += `<p>${attackerType==='player'?player.name:attacker.name} preparando ataque...</p>`;
    let count=0;
    rollInterval = setInterval(()=>{
        roll = Math.floor(Math.random()*6)+1;
        count++;
        if(count>=4){
            clearInterval(rollInterval);
            let attackVal = roll + attacker.destreza;
            let defenseRoll = Math.floor(Math.random()*6)+1 + defender.armadura;
            let damage = attackVal - defenseRoll;
            if(damage<0) damage=0;
            defender.pv -= damage;
            log.innerHTML += `<p>${attackerType==='player'?player.name:attacker.name} rolou ${roll}+Destreza(${attacker.destreza}) = ${attackVal}</p>`;
            log.innerHTML += `<p>${defender.name} defendeu com dado + Armadura = ${defenseRoll}</p>`;
            log.innerHTML += `<p>Dano causado: ${damage}. PV de ${defender.name}: ${defender.pv}</p>`;
            if(defender.pv<=0){
                alert(`${defender.name} derrotado!`);
                gainXP('combat',50);
                return;
            }
            if(attackerType==='player') rollDice('enemy', defender, attacker);
            else rollDice('player', attacker, defender);
        }
    },500);
}

// --- Loja ---
function openShop(){
    let content=`<h3>Loja</h3>
    <button onclick="buyItem('espada')">Comprar Espada +2 (20 Ouro)</button>
    <button onclick="buyItem('porcao')">Comprar Poção +10 PV (10 Ouro)</button>
    <button onclick="navigateLocation('cidade')">Voltar</button>`;
    document.getElementById('locationScreen').innerHTML = content;
}

function buyItem(item){
    if(item==='espada' && player.gold>=20){
        player.gold-=20;
        player.weapon={name:'Espada +2', forceBonus:2};
        alert('Espada comprada!');
    } else if(item==='porcao' && player.gold>=10){
        player.gold-=10;
        let slot = player.inventory.findIndex(x=>x===null);
        if(slot!==-1){
            player.inventory[slot]={name:'Poção', heal:10};
            alert('Poção comprada!');
        } else alert('Inventário cheio!');
    } else alert('Ouro insuficiente!');
    updateHUD();
}
</script>

</body>
</html>
